<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pengumuman - Links Grid by @TOMMY</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --transition: .3s;
            --radius: 16px;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f4f7f9;
            color: #1a202c;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background var(--transition), color var(--transition);
        }

        .card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, .05);
            padding: 30px;
            width: 100%;
            max-width: 440px;
            position: relative;
        }

        h2 {
            margin-top: 0;
            font-weight: 600;
            color: #3182ce;
            margin-bottom: 14px;
            text-align: center;
        }

        .subheader {
            font-size: 1.05em;
            font-weight: 600;
            color: #2d3748;
            text-align: left;
            margin-bottom: 2px;
        }

        .date {
            font-size: .85em;
            color: #718096;
            text-align: left;
            margin-bottom: 18px;
        }

        .announcement-text {
            font-size: .95em;
            line-height: 1.7;
            text-align: justify;
            color: #2d3748;
            margin-bottom: 24px;
            word-break: normal;
            overflow-wrap: break-word;
            /* potong hanya bila benar-benar perlu */
            white-space: pre-wrap;
        }


        .announcement-text a {
            color: #3182ce;
            text-decoration: underline;
            word-break: break-all;
            /* izinkan pecah di mana saja */
            overflow-wrap: anywhere;
            /* biar URL panjang bisa patah alami */
        }

        .announcement-text a:hover {
            color: #2563eb;
        }

        /* ===== Footer & Logo ===== */
        .logo-image {
            margin-top: 24px;
            text-align: center;
        }

        .logo-img-card {
            width: 100%;
            max-width: 240px;
            height: auto;
            object-fit: contain;
            display: inline-block;
            opacity: 0.9;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .logo-img-card:hover {
            transform: scale(1.05);
            opacity: 1;
        }

        body.dark-mode .logo-img-card {
            filter: brightness(1.1) contrast(1.1);
        }

        footer {
            margin-top: 10px;
            font-size: .9em;
            color: #a0aec0;
            line-height: 1.6;
            text-align: center;
        }

        footer a {
            color: #3182ce;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* ===== Theme switcher ===== */
        #theme-switcher {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e2e8f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
        }

        /* ===== Dark mode ===== */
        body.dark-mode {
            background: #121212;
            color: #e2e8f0;
        }

        body.dark-mode .card {
            background: #1e1e1e;
            border-color: #333;
        }

        body.dark-mode #theme-switcher {
            background: #2a2a2a;
            color: #fff;
        }

        body.dark-mode .announcement-text {
            color: #e2e8f0;
        }

        body.dark-mode .subheader {
            color: #e2e8f0;
        }

        body.dark-mode .date {
            color: #9ca3af;
        }

        .divider {
            border: none;
            border-top: 1px solid #cbd5e0;
            /* abu-abu lebih lembut */
            margin: 22px 0;
            opacity: 0.8;
        }

        body.dark-mode .divider {
            border-top-color: #444;
            opacity: 0.5;
        }

        h2 i {
            margin-right: 8px;
            /* jarak antara ikon dan teks */
        }
    </style>
</head>

<body>
    <div class="card">
        <button id="theme-switcher"><i class="fas fa-moon"></i></button>

        <h2><i class="fa-solid fa-bullhorn"></i> Pengumuman</h2>

        <br>

        <div id="announcementContainer">
            <div class="subheader">Memuat pengumuman...</div>
            <div class="announcement-text"><em>Menunggu data dari server...</em></div>
        </div>

        <div class="logo-image">
            <a href="https://espeje.com" target="_blank" rel="noopener noreferrer">
                <img src="logo-header.png" alt="Logo Portal" class="logo-img-card">
            </a>
        </div>

        <footer>
            Links Grid @TOMMY<br>
            Powered by <a href="https://espeje.com" target="_blank" rel="noopener noreferrer">https://espeje.com</a><br>
            <a href="https://news.t-o-m.my.id" target="_blank" rel="noopener noreferrer">Informasi &amp; Berita</a>
        </footer>
    </div>

    <!-- ====== SCRIPT ====== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import {
            getFirestore, collection, getDocs, orderBy, query
        } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCP2dnXfeRR57NNYarJSYtBDjve8K-bOd8",
            authDomain: "linktree-wannabe.firebaseapp.com",
            projectId: "linktree-wannabe",
            storageBucket: "linktree-wannabe.firebasestorage.app",
            messagingSenderId: "246673617043",
            appId: "1:246673617043:web:573d5386df8b29c945dd66"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function formatWIB(ts) {
            if (!ts) return "";
            const d = ts.toDate();
            d.setHours(d.getHours()); // konversi ke WIB
            const day = String(d.getDate()).padStart(2, "0");
            const month = String(d.getMonth() + 1).padStart(2, "0");
            const year = String(d.getFullYear()).slice(2);
            const jam = String(d.getHours()).padStart(2, "0");
            const menit = String(d.getMinutes()).padStart(2, "0");
            return `${day}/${month}/${year} ${jam}.${menit} WIB`;
        }

        async function loadAnnouncements() {
            const container = document.getElementById("announcementContainer");
            container.innerHTML = "<p><em>Memuat pengumuman...</em></p>";

            const q = query(collection(db, "announcements"), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);

            if (snap.empty) {
                container.innerHTML = "<p><em>Belum ada pengumuman.</em></p>";
                return;
            }

            container.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                const isiDenganLink = (d.isi || "").replace(
                    /(https?:\/\/[^\s]+)/g,
                    '<a href="$1" target="_blank">$1</a>'
                );
                container.innerHTML += `
            <div class="announcement-item">
                <div class="subheader">${d.judul || "Tanpa judul"}</div>
                <div class="date">${formatWIB(d.createdAt)}</div>
                <div class="announcement-text"><p>${isiDenganLink.replace(/\n/g, "<br>")}</p></div>
            </div>
            <hr class="divider">
            `;
            });
        }
        loadAnnouncements();

        // ===== Tema =====
        const themeBtn = document.getElementById("theme-switcher");
        const body = document.body;
        const icon = themeBtn.querySelector("i");
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
            body.classList.add("dark-mode");
            icon.classList.replace("fa-moon", "fa-sun");
        }
        themeBtn.addEventListener("click", () => {
            body.classList.toggle("dark-mode");
            const isDark = body.classList.contains("dark-mode");
            icon.classList.toggle("fa-sun", isDark);
            icon.classList.toggle("fa-moon", !isDark);
            localStorage.setItem("theme", isDark ? "dark" : "light");
        });
    </script>

</body>

</html>