<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Links Grid by @TOMMY</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --transition: .3s;
      --radius: 16px;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: #f4f7f9;
      color: #1a202c;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      transition: background var(--transition), color var(--transition);
    }

    .card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      box-shadow: 0 6px 25px rgba(0, 0, 0, .05);
      padding: 30px;
      width: 100%;
      max-width: 440px;
      text-align: center;
      position: relative;
    }

    .logo-icon {
      font-size: 3em;
      color: #3182ce;
      margin-bottom: 15px;
    }

    label {
      display: block;
      text-align: left;
      font-size: .85em;
      color: #4a5568;
      margin-bottom: 4px;
    }

    input,
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #cbd5e0;
      border-radius: 10px;
      font-size: .95em;
      margin-bottom: 12px;
      box-sizing: border-box;
      font-family: inherit;
      transition: border var(--transition);
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: #3182ce;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
      max-height: 250px;
    }

    button {
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: all var(--transition);
    }

    .btn-primary {
      background: #3182ce;
      color: #fff;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #1a202c;
    }

    .btn-secondary:hover {
      background: #cbd5e0;
      transform: translateY(-2px);
    }

    .grid-item {
      background: #f9fafb;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 12px;
      text-align: left;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    .grid-item .url {
      color: #3182ce;
      font-size: .85em;
      word-break: break-all;
      grid-column: 1/-1;
      margin-top: 4px;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .actions button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 5px 10px;
      font-size: .85em;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: #fff;
      cursor: pointer;
      height: 30px;
      line-height: 1;
      position: relative;
      top: -1px;
      /* tombol naik 1px agar baseline sejajar */
    }

    .actions button:hover {
      filter: brightness(.97);
    }

    .actions label {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 0;
      height: 30px;
      /* samakan tinggi dengan tombol */
    }

    /* Modern toggle sejajar sempurna */
    .toggle {
      appearance: none;
      width: 44px;
      height: 24px;
      border-radius: 12px;
      background: #cbd5e0;
      position: relative;
      top: -2px;
      /* naikkan 2px agar pas sejajar */
      cursor: pointer;
      transition: background .25s ease;
      outline: none;
      flex-shrink: 0;
      vertical-align: middle;
    }

    .toggle::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      top: 2px;
      left: 2px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      transition: transform .25s ease;
    }

    .toggle:checked {
      background: #3182ce;
    }

    .toggle:checked::before {
      transform: translateX(20px);
    }

    body.dark-mode .toggle {
      background: #555;
    }

    body.dark-mode .toggle:checked {
      background: #2563eb;
    }



    .actions button:hover {
      filter: brightness(.97);
    }

    .actions label {
      display: flex;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .toggle {
      appearance: none;
      width: 44px;
      height: 24px;
      border-radius: 12px;
      background: #cbd5e0;
      position: relative;
      cursor: pointer;
      transition: background .25s ease;
      outline: none;
      flex-shrink: 0;
    }

    .toggle::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      top: 2px;
      left: 2px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      transition: transform .25s ease;
    }

    .toggle:checked {
      background: #3182ce;
    }

    .toggle:checked::before {
      transform: translateX(20px);
    }

    body.dark-mode .toggle {
      background: #555;
    }

    body.dark-mode .toggle:checked {
      background: #2563eb;
    }

    .toast-actions {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 14px;
    }

    .toast-actions .toast-btn {
      flex: 0 0 100px;
      text-align: center;
    }

    #theme-switcher {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #e2e8f0;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      cursor: pointer;
    }

    footer {
      margin-top: 20px;
      font-size: .9em;
      color: #a0aec0;
    }

    footer a {
      color: #3182ce;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    body.dark-mode {
      background: #121212;
      color: #e2e8f0;
    }

    body.dark-mode .card {
      background: #1e1e1e;
      border-color: #333;
    }

    body.dark-mode input,
    body.dark-mode textarea {
      background: #2a2a2a;
      color: #fff;
      border-color: #444;
    }

    body.dark-mode .grid-item {
      background: #2a2a2a;
      border-color: #444;
    }

    body.dark-mode #theme-switcher {
      background: #2a2a2a;
      color: #fff;
    }

    .toast {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: #1a202c;
      border-radius: 14px;
      padding: 14px 18px;
      box-shadow: 0 6px 25px rgba(0, 0, 0, .15);
      backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      transition: opacity .3s ease, visibility .3s ease;
      text-align: center;
      z-index: 10000;
      min-width: 220px;
    }

    .toast.show {
      opacity: 1;
      visibility: visible;
    }

    .toast-btn {
      margin-top: 10px;
      background: #3182ce;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 8px 16px;
      cursor: pointer;
    }

    body.dark-mode .toast {
      background: rgba(30, 30, 30, 0.9);
      color: #e2e8f0;
    }

    .logo-image {
      margin-bottom: 15px;
    }

    .logo-img-admin {
      width: 100%;
      max-width: 260px;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      transition: transform 0.3s ease;
    }

    .logo-img-admin:hover {
      transform: scale(1.04);
    }

    /* Mode gelap: jaga agar logo tetap terlihat kontras */
    body.dark-mode .logo-img-admin {
      filter: brightness(1.1) contrast(1.1);
    }
  </style>
</head>

<body>
  <div class="card">
    <button id="theme-switcher"><i class="fas fa-moon"></i></button>
    <div class="logo-image">
      <picture>
        <source srcset="https://indonesia-afk.github.io/linktree/logo-header.webp" type="image/webp">
        <img src="https://indonesia-afk.github.io/linktree/logo-header.png" alt="Logo Portal" class="logo-img-admin">
      </picture>
    </div>

    <h2 id="title">Admin Login</h2>

    <div id="loginSection">
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button id="loginBtn" class="btn-primary">Masuk</button>
    </div>

    <div id="dashboard" style="display:none;">
      <label for="mainTitle">Judul Utama</label>
      <input type="text" id="mainTitle" placeholder="Judul utama (maks. 2 baris)">

      <label for="subTitle">Subjudul</label>
      <textarea id="subTitle" placeholder="Subjudul (maks. 3–4 baris)"></textarea>
      <button id="saveHeader" class="btn-primary">Simpan Header</button>

      <hr style="margin:20px 0;opacity:.3;">
      <div id="listContainer"></div>

      <!-- ✅ KEMBALIKAN FIELD INPUT YANG HILANG -->
      <label for="newName">Nama Link</label>
      <input type="text" id="newName" placeholder="Nama Link (misal: Formulir Pendaftaran)">
      <input type="url" id="newUrl" placeholder="Alamat URL (https://...)">

      <!-- ✅ Dua tombol sejajar -->
      <div style="display:flex; gap:10px;">
        <button id="addBtn" class="btn-primary" style="flex:1;">Tambah Link</button>
        <button id="clearBtn" class="btn-secondary" style="flex:0 0 100px;">Bersihkan</button>
      </div>

      <button id="logoutBtn" class="btn-secondary" style="margin-top:10px;">Keluar</button>
    </div>

    <footer>
      Links Grid @TOMMY<br>
      Powered by <a href="https://espeje.com" target="_blank" rel="noopener noreferrer">https://espeje.com</a><br>
      Informasi & Berita di <a href="https://news.t-o-m.my.id" target="_blank"
        rel="noopener noreferrer">https://news.t-o-m.my.id</a>
    </footer>
  </div>

  <div id="toast" class="toast">
    <div id="toastMsg"></div>
    <button id="toastBtn" class="toast-btn" style="display:none;">OK</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, updateDoc, doc, setDoc, query, orderBy, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCP2dnXfeRR57NNYarJSYtBDjve8K-bOd8",
      authDomain: "linktree-wannabe.firebaseapp.com",
      projectId: "linktree-wannabe",
      storageBucket: "linktree-wannabe.appspot.com",
      messagingSenderId: "246673617043",
      appId: "1:246673617043:web:573d5386df8b29c945dd66"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const loginSection = document.getElementById("loginSection");
    const dashboard = document.getElementById("dashboard");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const listContainer = document.getElementById("listContainer");
    const addBtn = document.getElementById("addBtn");
    const newName = document.getElementById("newName");
    const newUrl = document.getElementById("newUrl");
    const mainTitle = document.getElementById("mainTitle");
    const subTitle = document.getElementById("subTitle");
    const saveHeader = document.getElementById("saveHeader");
    let editId = null;

    // Tombol Bersihkan field input
    const clearBtn = document.getElementById("clearBtn");
    clearBtn.addEventListener("click", () => {
      newName.value = "";
      newUrl.value = "";
      editId = null;
      addBtn.textContent = "Tambah Link";
      showToast("Form dibersihkan");
    });


    // Toast
    const toast = document.getElementById("toast"), toastMsg = document.getElementById("toastMsg"), toastBtn = document.getElementById("toastBtn");
    let toastTimer = null;
    function hideToast() { toast.classList.remove("show"); toastBtn.style.display = "none"; clearTimeout(toastTimer); }
    function showToast(msg, type = "info", ms = 2000) { toastMsg.textContent = msg; toastBtn.style.display = "none"; toast.classList.add("show"); clearTimeout(toastTimer); toastTimer = setTimeout(hideToast, ms); }
    function showModal(msg, type = "info", onOk = () => { }) { const old = toast.querySelector(".toast-actions"); if (old) old.remove(); toastMsg.textContent = msg; toastBtn.style.display = "inline-block"; toast.classList.add("show"); clearTimeout(toastTimer); toastBtn.onclick = () => { hideToast(); onOk(); }; }
    function showConfirm(msg, type = "warning", onOk = () => { }, onCancel = () => { }) { const old = toast.querySelector(".toast-actions"); if (old) old.remove(); toastMsg.textContent = msg; toastBtn.style.display = "none"; toast.classList.add("show"); clearTimeout(toastTimer); const box = document.createElement("div"); box.className = "toast-actions"; const ok = document.createElement("button"); ok.className = "toast-btn"; ok.textContent = "OK"; ok.style.background = "#3182ce"; ok.style.color = "#fff"; const cancel = document.createElement("button"); cancel.className = "toast-btn"; cancel.textContent = "Batal"; cancel.style.background = "#e2e8f0"; cancel.style.color = "#1a202c"; ok.onclick = () => { hideToast(); onOk(); }; cancel.onclick = () => { hideToast(); onCancel(); }; box.append(cancel, ok); toast.appendChild(box); }

    // Utility
    function normalizeUrl(url) { if (!url) return ""; return /^https?:\/\//i.test(url) ? url : `https://${url}`; }
    function iconFromName(name) {
      const n = (name || "").toLowerCase();
      if (/pdf|unduhan|download/.test(n)) return "fa-file-pdf";
      if (/dokumen|arsip|berkas|file/.test(n)) return "fa-file-alt";
      if (/formulir|pendaftaran|input/.test(n)) return "fa-clipboard-list";
      if (/tutorial|panduan|video|youtube/.test(n)) return "fa-video";
      if (/izin|akses|login/.test(n)) return "fa-key";
      if (/laporan|hasil|evaluasi/.test(n)) return "fa-chart-line";
      if (/kontak|hubungi|email/.test(n)) return "fa-envelope";
      if (/jadwal|kalender|agenda/.test(n)) return "fa-calendar";
      if (/berita|pengumuman|informasi/.test(n)) return "fa-bullhorn";
      if (/bantuan|panduan|tanya/.test(n)) return "fa-circle-info";
      if (/profil|pengguna|akun/.test(n)) return "fa-user";
      if (/link|tautan|situs/.test(n)) return "fa-link";
      if (/sppd|perjalanan|dinas/.test(n)) return "fa-briefcase";
      const f = ["fa-star", "fa-rocket", "fa-lightbulb", "fa-layer-group", "fa-heart", "fa-circle-check"];
      return f[Math.floor(Math.random() * f.length)];
    }

    // Header
    async function loadHeader() { const s = await getDoc(doc(db, "site_header", "main")); if (s.exists()) { const d = s.data(); mainTitle.value = d.mainTitle || ""; subTitle.value = d.subTitle || ""; } }
    saveHeader.addEventListener("click", async () => { try { await setDoc(doc(db, "site_header", "main"), { mainTitle: mainTitle.value.trim(), subTitle: subTitle.value.trim() }); showToast("Header disimpan", "success"); } catch (e) { showModal("Gagal menyimpan header: " + e.message, "error"); } });

    // CRUD Grid
    async function loadGrid() { const q = query(collection(db, "grid_links"), orderBy("order", "asc")); const snap = await getDocs(q); listContainer.innerHTML = ""; snap.forEach(d => { const data = d.data(); const id = d.id; listContainer.insertAdjacentHTML("beforeend", `<div class="grid-item" data-id="${id}"><div><strong>${data.name}</strong></div><div class="actions"><button data-edit="${id}"><i class="fas fa-edit"></i><span>Edit</span></button><button data-del="${id}"><i class="fas fa-trash"></i><span>Hapus</span></button><label title="Tampilkan di index"><input type="checkbox" class="toggle" data-toggle="${id}" ${data.active !== false ? "checked" : ""}></label><span class="drag-handle" title="Geser untuk ubah urutan"><i class="fas fa-grip-vertical"></i></span></div><div class="url">${data.url}</div></div>`); }); attachRowEvents(); enableDragSort(); }

    function attachRowEvents() {
      // Tombol Edit
      listContainer.querySelectorAll("[data-edit]").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.edit;
          const item = btn.closest(".grid-item");
          const name = item.querySelector("strong").textContent.trim();
          const url = item.querySelector(".url").textContent.trim();
          newName.value = name;
          newUrl.value = url;
          addBtn.textContent = "Simpan Perubahan";
          editId = id;
        };
      });

      // Tombol Hapus → ada dialog OK/Batal, lalu toast 2 detik setelah sukses
      listContainer.querySelectorAll("[data-del]").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.del;
          showConfirm("Hapus link ini?", "warning", async () => {
            try {
              await deleteDoc(doc(db, "grid_links", id));
              // bersihkan tombol lama di dalam toast
              const oldActions = toast.querySelector(".toast-actions");
              if (oldActions) oldActions.remove();
              // tampilkan notifikasi pendek 2 detik
              showToast("Link dihapus", "success");
              loadGrid();
            } catch (e) {
              showModal("Gagal menghapus: " + e.message, "error");
            }
          });
        };
      });

      // Toggle aktif/nonaktif → hanya toast biasa 2 detik
      listContainer.querySelectorAll("[data-toggle]").forEach(chk => {
        chk.onchange = async () => {
          const id = chk.dataset.toggle;
          try {
            await updateDoc(doc(db, "grid_links", id), { active: chk.checked });
            showToast(chk.checked ? "Diaktifkan" : "Dinonaktifkan", "success");
          } catch (e) {
            showModal("Gagal update status: " + e.message, "error");
          }
        };
      });
    }




    addBtn.addEventListener("click", async () => { const name = newName.value.trim(); let url = newUrl.value.trim(); if (!name || !url) return showModal("Isi nama dan URL terlebih dahulu", "warning"); url = normalizeUrl(url); const icon = iconFromName(name); try { if (editId) { await updateDoc(doc(db, "grid_links", editId), { name, url, icon }); editId = null; addBtn.textContent = "Tambah Link"; showToast("Perubahan disimpan", "success"); } else { const s = await getDocs(collection(db, "grid_links")); if (s.size >= 12) return showModal("Maksimal 12 link", "warning"); await addDoc(collection(db, "grid_links"), { name, url, icon, order: s.size + 1, active: true }); showToast("Link ditambahkan", "success"); } newName.value = ""; newUrl.value = ""; loadGrid(); } catch (e) { showModal("Operasi gagal: " + e.message, "error"); } });

    // Drag & Drop
    function enableDragSort() { const items = [...listContainer.querySelectorAll(".grid-item")]; items.forEach(el => { el.setAttribute("draggable", "true"); el.addEventListener("dragstart", e => { el.classList.add("dragging"); e.dataTransfer.effectAllowed = "move"; }); el.addEventListener("dragover", e => { e.preventDefault(); const dragging = listContainer.querySelector(".dragging"); if (!dragging || dragging === el) return; const rect = el.getBoundingClientRect(); const before = (e.clientY - rect.top) < rect.height / 2; listContainer.insertBefore(dragging, before ? el : el.nextSibling); }); el.addEventListener("dragend", () => { el.classList.remove("dragging"); persistOrder(); }); }); }
    async function persistOrder() { try { const rows = [...listContainer.querySelectorAll(".grid-item")]; const batch = writeBatch(db); rows.forEach((row, idx) => batch.update(doc(db, "grid_links", row.dataset.id), { order: idx + 1 })); await batch.commit(); showToast("Urutan disimpan", "success"); } catch (e) { showModal("Gagal menyimpan urutan: " + e.message, "error"); } }

    // Auth
    loginBtn.addEventListener("click", async () => { try { await signInWithEmailAndPassword(auth, email.value, password.value); } catch (e) { showModal("Login Gagal"); } });
    document.getElementById("loginSection").addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); loginBtn.click(); } });
    onAuthStateChanged(auth, (user) => { if (user) { loginSection.style.display = "none"; dashboard.style.display = "block"; title.textContent = "Links Grid @TOMMY Admin"; loadHeader(); loadGrid(); } else { loginSection.style.display = "block"; dashboard.style.display = "none"; title.textContent = "Admin Login"; } });
    logoutBtn.addEventListener("click", () => signOut(auth));

    // Theme
    const themeSwitcher = document.getElementById("theme-switcher");
    const body = document.body;
    const themeIcon = themeSwitcher.querySelector("i");
    themeSwitcher.addEventListener("click", () => { body.classList.toggle("dark-mode"); themeIcon.classList.toggle("fa-moon"); themeIcon.classList.toggle("fa-sun"); });
  </script>
</body>

</html>